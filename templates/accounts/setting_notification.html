{% extends "accounts/settings.html"  %}
{% block title %}短信提醒{% endblock %}
{% block content_content %}
<div class="page-header">
    <h3>短信提醒</h3>
</div>
<table class="table table-striped table-condensed">
    <thead>
        <tr>
            <th>选择</th>
            <th>状态</th>
            <th>标题</th>
            <th>内容</th>
        </tr>
    </thead>
    <tbody>
        {% if notices %}
        {% for notice in notices %}
        <tr>
            <td><input type="checkbox" data-notifictaion-id="{{notice.id}}" /></td>
            <td>{%if notice.unseen %}<span class="label label-success">未读</span>{%else%}<span class="label">已读</span>{%endif%}</td>
            <td><a href="javascript:void(0)">{{notice.notice_type.display }}</a></td>
            <td class="notice_time">{{ notice.added|timesince }}前</td>
        </tr>
        <tr style="display:none;"><td colspan="4">{{notice.message|safe }}</td></tr>
        {% endfor %}
        {% else %}
        <tr><td colspan="4">暂时没有短信</td></tr>
        {% endif %}
        <tr>
            <td colspan="4"><!--button class="btn btn-error">删除</button--></td>
        </tr>
    </tbody>
</table>
        
{% endblock %}

{% block script %}
<script>
$(document).ready(function(){
   $('table tbody tr').find('td:eq(2)').on('click', function(){
       if ($(this).prev().text() == '未读'){
           var status = $(this).prev(),
               id = $(this).prev().prev().find('input').first().data('notifictaionId');
               console.log(id)
           $.ajax({type: 'POST', data:{'notice_id': id}, success: function(){
               status.html('<span class="label">已读</span>');
               }
           });
       };
       
       var content = $(this).parent().next();
       if (content.is(":visible")){
           $(this).parent().next().hide();
       }else{
           $(this).parent().next().show();
       }
   }) 
});

</script>
{% endblock %}