{% extends "base.html"  %}
{% load relationship_tags %}
{% block title %}{{profile.user.username}} {% endblock %}
{% block content %}
<div class="container">
    
    <div class="row">
        <div class="span3">
            <a href="javascript:void(0)" class="thumbnail"><img src="/media/{{profile.avatar.name}}" width="200" height="250" /></a>
        </div>
        <div class="span9">
            <div class="row">
                <div class="span6"><h1>{{profile.user.username}}</h1><p>{{profile.intro}}</p></div>
                <div class="span2" style="border-left:1px solid #CCC; float: right; padding-left: 10px; ">
                    <label>人气：{{profile.popularity.all.count}}</label>
                    <label>关注：<a href = "{%url list_follow_user%}?user={{profile.user}}&direction=following">{{profile.user.relationships.following.count}}</a></label>
                    <label>粉丝：<a href = "{%url list_follow_user%}?user={{profile.user}}&direction=follower">{{profile.user.relationships.followers.count}}</a></label>
                </div>
            </div>
            <hr style="margin: 0px;"/>
            
            <div class="tabbable tabs-below">
                <div class="tab-content">
                  <div class="tab-pane active" id="A">
                    <div class="skill-list">
                        <ul>
                           <li>
                             <span class="heading">
                                <div class="image"><img src="/static/images/icons/icon_artist.png"> </div>
                                画师 Lv.8
                             </span>
                           </li>
                           <li><span class="active">素描</span></li>
                           <li><span>厚涂</span></li>
                           <li><span>学院派</span></li>
                           <li><span>达芬奇流</span></li>
                           <li><span>油画</span></li>
                           <li><span>水彩</span></li>
                           <li><span>粉笔</span></li>
                           <li><span class="active">印象派</span></li>
                           <li><span>幼儿园画派</span></li>
                        </ul>
                    </div>
                    
                    <div class="skill-list">
                        <ul>
                            <li>
                                <span class="heading">
                                    <div class="image"><img src="/static/images/icons/icon_music.png"> </div>
                                    写手 Lv.1
                                </span>
                            </li>
                            <li><span>YYC</span></li>
                            <li><span>HYZ</span></li>
                            <li><span class="active">Miss</span></li>
                            <li><span>YYM</span></li>
                        </ul>
                    </div>

                    <div class="skill-list">
                        <ul>
                            <li>
                                <span class="heading">
                                    <div class="image"><img src="/static/images/icons/icon_project.png"> </div>
                                    围观 Lv.1
                                </span>
                            </li>
                            <li><span>YYC</span></li>
                            <li><span>HYZ</span></li>
                            <li><span class="active">Miss</span></li>
                            <li><span>YYM</span></li>
                        </ul>
                    </div>

                  </div>
                  <div class="tab-pane" id="B">
                    <p>Howdy, I'm in Section B.</p>
                  </div>
                </div>
                <ul class="nav nav-tabs" style="float: left;">
                  <li class="active"><a href="#A" data-toggle="tab">信息 | Info</a></li>
                  <li><a href="#B" data-toggle="tab">技能 | Skill</a></li>
                </ul>
                {% if request.user.id != profile.user_id %}
                <div class="span4 cfont-msf-yahei" style="float: right; margin-right: -50px;">
                    
                        {% if_relationship request.user profile.user "following" %}
                    <button id="id_follow_btn" class="btn btn-error" data-action="unfollow" data-user-id="{{profile.user.id}}"><i class="icon-bookmark icon-dark-grey" style="margin-top: 2px;"></i>取消</button>
                        {% else %}
                    <button id="id_follow_btn" class="btn btn-primary" data-action="follow" data-user-id="{{profile.user.id}}"><i class="icon-bookmark icon-white" style="margin-top: 2px;"></i>关注</button>
                        {% endif_relationship %}
                    <button class="btn" id="id_invite_btn" data-toggle="modal" data-backdrop="true" data-keyboard="true"><i class="icon-random icon-dark-grey" style="margin-top: 2px;"></i>邀请</button>
                    <button class="btn"><i class="icon-comment icon-dark-grey" style="margin-top: 2px;"></i> 留言</button>
                </div>
                {% endif %}
            </div>
            
            
        </div>
    </div>
    
    <div class="row">
        <div class="span8">
            <div class="accordion-group">
                <div class="accordion-heading group-title"> 
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseOne"> 
                      主要作品 | Works 
                    </a> 
                </div>
                <div class="accordion-body collapse in">
                    <div class="accordion-inner">
                        {% if works.main %}
                        <table class="table table-bordered">
                            <tr>
                                <td>
                                    <img src="/media/{{works.main.cover|default:"no_cover.gif"}}" width="120" style="border-radius: 5px;" />
                                    <div><b>创建</b>： {{works.main.created|date:"Y/m/d"}}<br/>
                                        <b>浏览</b>： 1987 <br/>
                                    </div>
                                </td>
                                <td>
                                    <div style="float:left"><h4><img src="/static/images/icons/icon_2.png"/>{{works.main.name}}</h4></div>
                                    <div style="float:right"><span class="label label-info">{{works.main.category}}</span> &nbsp;&nbsp; <span class="label label-info">{{works.main.category}}</span></div>
                                    <div class="clearfix"></div>
                                    <hr style="margin:0px;"/>
                                    <div class="pagination" style="margin:15px 20px 10px 0px">
                                     <ul>
                                       <li class="active">
                                         <a href="{%url ajax_get_element 1 1 %}">第1章</a>
                                       </li>
                                       <li><a href="#">第二章</a></li>
                                       <li><a href="#">第三章</a></li>
                                       <li><a href="#">第四章</a></li>
                                       <li><a href="#">第五章</a></li>
                                       <li><a href="#">第六章</a></li>
                                     </ul>
                                     <p>{{works.main.elements}}</p>
                                   </div>
                                </td>
                            </tr>
                        </table>
                        {% else %}暂时没有作品{% endif %}
                    </div>
                </div> 
            </div>
            
            <div class="accordion-group"> 
              <div class="accordion-heading group-title"> 
                <a class="accordion-toggle" data-toggle="collapse" href="#original"> 
                  主创企划 | Impossible Original
             <span style="float: right;"><i class="icon-th-list icon-light-blue"></i></span>
                </a> 
              </div> 
              <div id="original" class="accordion-body in collapse" style="height: auto; "> 
                <div class="accordion-inner">
                    <ul class="thumbnails"> 
                    {% for work in profile.user.work_set.all%}
                        <li class="span2" style="width: 120px">
                            <dl>
                                <dt><a href="{%url show_work work.pk%}" class="thumbnail"> <img src="/media/{{work.cover|default:"no_cover.gif"}}" width="110px" height="110px"> </a></dt>
                                <dd><a href="{%url show_work work.pk%}">{{work.name}}</a></dd>
                            </dl>
                        </li>
                    {% endfor %}
                    </ul>
                </div> 
              </div> 
            </div>
            
            <div class="accordion-group"> 
              <div class="accordion-heading group-title"> 
                <a class="accordion-toggle" data-toggle="collapse" href="#joined"> 
                  参与企划 | Impossible Original
             <span style="float: right;"><i class="icon-th-list icon-light-blue"></i></span>
                </a> 
              </div> 
              <div id="joined" class="accordion-body in collapse" style="height: auto; "> 
                <div class="accordion-inner">
                    {% if joined %}
                    <ul class="thumbnails"> 
                    {% for work in joined%}
                        <li class="span2" style="width: 120px">
                            <dl>
                                <dt><a href="{%url show_work work.pk%}" class="thumbnail"> <img src="/media/{{work.cover|default:"no_cover.gif"}}" width="110px" height="110px"> </a></dt>
                                <dd><a href="{%url show_work work.pk%}">{{work.name}}</a></dd>
                            </dl>
                        </li>
                    {% endfor %}
                    </ul>
                    {% else %}
                    暂时没有参与的企划
                    {% endif %}
                </div> 
              </div> 
            </div>
            
            <div class="accordion-group"> 
              <div class="accordion-heading group-title"> 
                <a class="accordion-toggle" data-toggle="collapse" href="#followed">关注企划 | Impossible Original<span style="float: right;"><i class="icon-th-list icon-light-blue"></i></span></a> 
              </div> 
              <div id="followed" class="accordion-body in collapse" style="height: auto; "> 
                <div class="accordion-inner">
                    {% if followed %}
                    <ul class="thumbnails"> 
                    {% for work in followed%}
                        <li class="span2" style="width: 120px">
                            <dl>
                                <dt><a href="{%url show_work work.pk%}" class="thumbnail"> <img src="/media/{{work.cover|default:"no_cover.gif"}}" width="110px" height="110px"> </a></dt>
                                <dd><a href="{%url show_work work.pk%}">{{work.name}}</a></dd>
                            </dl>
                        </li>
                    {% endfor %}
                    </ul>
                    {% else %}
                    暂时没有关注的企划
                    {% endif %}
                </div> 
              </div> 
            </div>
        </div>
        
        <div class="span4">
            <div class="accordion-group">
                <div class="accordion-heading group-title">
                    <a class="accordion-toggle" data-toggle="collapse" href="#collapseOne"> 
                      相册 <span>Album</span>
                    </a>
                </div>
                <div class="accordion-inner" style="padding-bottom: 0px;">
                  <div id="myCarousel" class="carousel slide"> 
                     <div class="carousel-inner"> 
                       <div class="item active fixed-height"> 
                         <img src="/static/images/sample/carousel/crs_0.jpg" alt=""> 
                         <div class="carousel-caption"> 
                           <h4>First Thumbnail label</h4> 
                           <p>ピカピカぴかりんじゃんけんポン♪</p> 
                         </div> 
                       </div> 
                       <div class="item fixed-height"> 
                         <img src="/static/images/sample/carousel/crs_1.jpg" alt=""> 
                         <div class="carousel-caption"> 
                           <h4>Second Thumbnail label</h4> 
                           <p>選んでくれてありがとう</p> 
                         </div> 
                       </div> 
                       <div class="item fixed-height"> 
                         <img src="/static/images/sample/carousel/crs_5.jpg" alt=""> 
                         <div class="carousel-caption"> 
                           <h4>Third Thumbnail label</h4> 
                           <p>戦闘力高そうな学級委員長</p> 
                         </div> 
                       </div>
                       <div class="item fixed-height"> 
                         <img src="/static/images/sample/carousel/crs_3.jpg" alt=""> 
                         <div class="carousel-caption"> 
                           <h4>Third Thumbnail label</h4> 
                           <p>たまには夜更かししませんか</p> 
                         </div> 
                       </div>
                       <div class="item fixed-height"> 
                         <img src="/static/images/sample/carousel/crs_4.jpg" alt=""> 
                         <div class="carousel-caption"> 
                           <h4>Third Thumbnail label</h4> 
                           <p>きみとわかちあうささやかなしあわせをこれからも。</p> 
                         </div> 
                       </div> 
                     </div> 
                     <a class="left carousel-control" href="#myCarousel" data-slide="prev">‹</a> 
                     <a class="right carousel-control" href="#myCarousel" data-slide="next">›</a> 
                   </div> 
               </div>
            </div>

        </div><!-- END sidebar -->
        
    </div>

</div>



                                {% for skill in skill_list%}
                                <li class="{{skill.skill}}">
                                    {{skill.skill}} <strong>exp{{skill.exp}}</strong>
                                </li>
                                {% endfor %}

            <!--div class="page-header">
                <h1>新鲜事</h1>
                <ul>
                    {% for e in timeline %}
                    <li>
                        [{{e.created|date:"Y-m-d H:m:s"}}] {{e.user.username}} 为 <a href="/works/show_work/{{e.instance.work_id }}">{{e.instance.work.name}}</a> 新增了一个 <a href="/works/show_element/{{e.instance.id}}">{{e.instance.get_category_display}}</a>
                    </li>
                    {% endfor %}
                </ul>
            </div-->
            

<div id="id_invite" class="modal hide fade">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">&times;</a>
        <h3>选择邀请加入的作品</h3>
    </div>
    <form method="post" action="{%url ajax_user_invite %}">
        {% csrf_token %}
    <div class="modal-body">
        <div class="control-group">
            <label class="control-label" for="normalSelect">选择作品：</label>
            <div class="control">
                <select name="work_id" id="id_invite_work">
                    {% for work in request.user.work_set.all%} <option value = "{{work.pk}}">{{work.name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="normalSelect">选择角色：</label>
            <div class="control">
                <select name="role" id="id_invite_role">
                    <option value="image">画师</option>
                    <option value="word">写手</option>
                    <option value="other">其他</option>
                </select>
            </div>
        </div>
        <div class="control-group">
            <label class="control-label" for="textarea">邀请理由：</label>
            <div class="control">
                <textarea class="large" id="id_invite_reason" name="reason" rows="5"></textarea>
            </div>
            <span class="help-block">最多300个字符</span>
        </div>
    </div>
    <div class="modal-footer">
        <input type="hidden" name="uid" value="{{profile.user.id}}" />
        <input type="submit" class="btn btn-success" value="发送邀请">
    </div>
    </form>
</div>

<div class="modal hide fade in" id="alertModal">
  <div class="modal-header">
    <a class="close" data-dismiss="modal">×</a>
    <h3></h3>
  </div>
  <div class="modal-body">
    <p> </p>
  </div>
  <div class="modal-footer">
    <a  class="btn btn-success"></a>
  </div>
</div>

{% endblock %}

{% block script %}
<script type="text/javascript" src="/static/js/bootstrap/bootstrap-modal.js"></script>
<script type="text/javascript" src="/static/js/bootstrap/bootstrap-collapse.js"></script>

<script>
$(document).ready(function(){
    {% if not user.is_authenticated %}
    var uid = 0;
    $('#id_follow_btn, #id_invite_btn').on('click', function(){
        Controller.alert.noLogin();
    });
    {% else %}
        var uid = {{profile.user.id}};
        $('#id_follow_btn').on('click', function(){
            var action = $(this).data('action');
            Controller.follow($(this) ,uid, action);
        });
        $('#id_invite_btn').click(function(e){
            {% if request.user.work_set.count %}
            $('#id_invite').modal('show');
            {% else %}
            Controller.alert.noWorks();
            {% endif %}
        });
    {% endif %}
        
    $('#id_invite form').submit(function(e){
        var data = $(this).serialize();
        data['uid'] = uid;
        Controller.invite(data);
        e.preventDefault();
    });
});
var Controller = {
    invite : function(data){
        $.ajax({
            url : '{%url ajax_user_invite %}', 
            type: 'post', 
            data: data,
            success: function(data){
                var data = JSON.parse(data, status);
                Controller.alert.invited();
            }
        });
        $('#id_invite').modal('hide');
    },
    follow : function(btn, uid, action){
        $.ajax({type: 'get', url: '{%url ajax_user_follow %}', data:{'uid': uid, 'action': action}, 
            success: function(data){
                var data = JSON.parse(data, status);
                data.action == 'follow' ? btn.html('<i class="icon-bookmark icon-dark-grey" style="margin-top: 2px;"></i>取消').removeClass('btn-primary').data('action', 'unfollow'):btn.html('<i class="icon-bookmark icon-white" style="margin-top: 2px;"></i>关注').addClass('btn-primary').data('action', 'follow');
            }
        });
    },
    alert : {
        noLogin : function(){
            $('#alertModal .modal-header h3').text('错误信息');
            $('#alertModal .modal-body p').text('您还没有登录，请先登录');
            $('#alertModal .modal-footer a').attr("href", "/login/?next={%url profile profile.user.username%}");
            $('#alertModal .modal-footer a').text(">>跳转到登录页面");
            $('#alertModal').modal({'show': true});
        },
        noWorks : function(){
            $('#alertModal .modal-header h3').text('错误信息');
            $('#alertModal .modal-body p').text('您还没有作品，无法邀请');
            $('#alertModal .modal-footer a').attr("href", "{%url add_work%}");
            $('#alertModal .modal-footer a').text(">>跳转到创建作品页面");
            $('#alertModal').modal({'show': true});
        },
        invited : function(){
            $('#alertModal .modal-header h3').text('操作成功');
            $('#alertModal .modal-body p').text('您的邀请已经成功发送');
            $('#alertModal .modal-footer a').attr("data-dismiss", "modal");
            $('#alertModal .modal-footer a').text("确定");
            $('#alertModal').modal({'show': true});
        }
    }
};
</script>
{% endblock %}
